## 1. 프로젝트 개요

- **목적**
    
    팀 단위로 프롬프트 연구 및 제출을 관리하고, 정량적 평가를 통해 **리더보드**를 제공하는 온라인 플랫폼.
    
    참가자는 매일 제한된 횟수 내에서 제출을 반복하며 점수를 개선할 수 있음.
    
- **범위**
    - 팀 등록 및 인증 (이메일 + API 토큰)
    - 제출물 업로드 및 제한 관리
    - 연구용 LLM 호출 및 횟수 제한
    - 평가 환경 배치 실행 및 로그 관리
    - 리더보드 제공
---

## 2. 주요 제약 조건

- 계정 단위는 **팀 단위** (개별 사용자 없음).
- 인증은 **이메일 + 팀 API 토큰** (비밀번호 없음).
- 제출 제한: **하루 3회**.
- 연구용 LLM 호출 제한: **팀별 분당 10회**.
- 제출물은 **.py 파일**만 허용, S3에 저장.
- 평가용 LLM은 별도의 배치 전용 환경에서 실행.
- 리더보드는 **최고 점수(또는 최종 선택)** 기반으로 노출.

---

## 3. 사용자 여정 (팀 관점)

### 3.1 제출 프로세스

1. 팀 생성 및 인증 (이메일 + API 토큰 발급).
2. `.py` 파일 제출 → S3 저장.
3. 정적 검증/기본 스캔 → 상태: `pending`.
4. 검증 완료 후 대기열로 이동 (`queued`).
5. 배치 평가 실행 시 `evaluating → completed`.
6. 점수 산출 → 리더보드 반영.
7. 필요 시 **최종 선택 제출물** 지정.

### 3.2 리더보드 확인

- 팀 이름, 점수, 제출 수, 등록일, 마지막 제출일 표시.
- 정렬:
    - 기본: 점수 내림차순
    - 동점 시: 등록일 빠른 팀 우선
    - 옵션: 제출 횟수 적은 팀 우선
- 필터:
    - 최근 배치 날짜별
    - 팀 이름 검색
    - 최소 제출 수 조건

### 3.3 연구용 LLM 사용

- API 토큰 기반 호출.
- 분당 10회 제한(토큰 버킷 기반).
- 초과 시 **429 Too Many Requests** 반환 + `Retry-After` 헤더.
- 운영자 대시보드: 팀별 호출량 그래프, 초과 발생률 확인 가능.

---

## 4. 데이터 모델 개요

- **teams**: 팀 기본 정보 및 인증 관리.
- **submissions**: 제출물 관리 및 상태 추적.
- **submission_quotas**: 하루 제출 횟수 제한 관리.
- **llm_usage_logs**: LLM 호출 기록 (연구/평가 분리).
- **llm_usage_rate_limits**: 분당 호출량 관리.
- **evaluation_batches**: 평가 배치 실행 기록.
- **batch_submissions**: 배치와 제출물 매핑.
- **leaderboard (MView)**: 리더보드 제공용.
- **team_submission_history (View)**: 팀별 제출 히스토리.
- **audit_logs**: 감사 로그(보안/운영 추적).

---

## 5. 평가 정책

- **대표 점수 선택**
    - 기본: 최고 점수 사용.
    - 최종 선택 제출물이 있으면 그 점수를 우선.
- **배치 평가**
    - 1회 배치: 최대 300개 제출물.
    - Docker 기반 환경에서 실행, seed 고정.
    - 병렬성 제한(K 값).
- **실패 처리**
    - 검증/평가 실패 시 상태와 오류 로그 기록.
    - 실패 제출물은 리더보드 반영되지 않음.

---

## 6. 리더보드 UI

- **컬럼**
    - 팀 이름 | 점수 | 제출 수 | 등록일 | 마지막 제출일
- **정렬/필터**
    - 점수순, 등록일순, 제출 수순
    - 검색: 팀 이름
    - 필터: 최근 배치별, 제출 횟수
- **팀 상세 패널**
    - 팀 메타데이터
    - 제출 히스토리 (상태, 점수, 날짜)
    - 평가 로그 및 오류 메시지

---

## 7. 운영자 기능

- 팀 관리 (활성/비활성화, 메타데이터 편집).
- 제출물 모니터링 (상태, 에러 로그).
- 평가 배치 실행 및 모니터링.
- LLM 사용량 분석 (토큰 소비량, 초과 발생률).
- 감사 로그 확인.